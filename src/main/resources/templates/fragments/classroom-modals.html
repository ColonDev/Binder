<th:block xmlns:th="http://www.thymeleaf.org">
    <!-- CREATE POST MODAL -->
    <div id="postCreateModal" class="modal-overlay" aria-hidden="true"
         th:if="${isTeacher and hasClass}"
         th:fragment="postCreateModal">
        <div class="modal" style="max-width:720px;">
            <div class="modal-header">
                <div class="modal-title">Create Post</div>
                <button class="modal-close" type="button" data-action="close-modal" data-modal-id="postCreateModal">×</button>
            </div>

            <div class="modal-body">
                <label class="field-label" for="pcType">Type</label>
                <select id="pcType" class="select">
                    <option value="ASSIGNMENT">Assignment</option>
                    <option value="RESOURCE">Resource (upload)</option>
                </select>
            </div>

            <!-- Assignment -->
            <form id="assignmentForm" class="modal-body" method="post" th:action="@{/classroom/post/assignment/add}" enctype="multipart/form-data">
                <input type="hidden" th:if="${_csrf != null}"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="classroomId" th:value="${classroom.classId}" />

                <label class="field-label" for="pcAssignmentTitle">Title</label>
                <input id="pcAssignmentTitle" class="input" name="title" maxlength="80" placeholder="Title" required />

                <label class="field-label" for="pcAssignmentDesc">Description</label>
                <textarea id="pcAssignmentDesc" class="textarea" name="description" maxlength="4000" placeholder="Description"></textarea>

                <label class="field-label" for="pcAssignmentFile">Attachment (optional)</label>
                <input id="pcAssignmentFile" class="input js-file-input" type="file" name="file" multiple data-preview-target="pcAssignmentPreview" />
                <div id="pcAssignmentPreview" class="file-preview" aria-live="polite"></div>

                <div class="row">
                    <div class="col">
                        <label class="field-label" for="dueLocal">Due</label>
                        <input id="dueLocal" class="input" type="datetime-local" />
                        <input type="hidden" id="dueHidden" name="dueDate" />
                        <div class="help">Leave blank for no due date.</div>
                    </div>
                    <div class="col">
                        <label class="field-label" for="pcTimeToComplete">Time to complete</label>
                        <input id="pcTimeToComplete" class="input" name="timeToComplete" maxlength="32" placeholder="e.g. 2h" />
                    </div>
                </div>

                <label class="field-label" for="pcMaxMarks">Maximum marks</label>
                <input id="pcMaxMarks" class="input" name="maxMarks" type="number" min="0" placeholder="0" />

                <div class="modal-actions">
                    <button class="btn" type="button" data-action="close-modal" data-modal-id="postCreateModal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Create</button>
                </div>
            </form>

            <!-- Resource (upload) -->
            <form id="resourceForm"
                  class="modal-body"
                  method="post"
                  th:action="@{/classroom/post/resource/add}"
                  enctype="multipart/form-data"
                  style="display:none;">

                <input type="hidden" th:if="${_csrf != null}"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="classroomId" th:value="${classroom.classId}" />

                <label class="field-label" for="pcResourceTitle">Title</label>
                <input id="pcResourceTitle" class="input" name="title" maxlength="80" placeholder="Title" required />

                <label class="field-label" for="pcResourceFile">Upload file</label>
                <input id="pcResourceFile" class="input js-file-input" type="file" name="file" multiple data-preview-target="pcResourcePreview" required />
                <div id="pcResourcePreview" class="file-preview" aria-live="polite"></div>
                <div class="help">Resources are uploaded files (not links).</div>

                <label class="field-label" for="pcResourceDesc">Description</label>
                <textarea id="pcResourceDesc" class="textarea" name="description" maxlength="4000" placeholder="Description"></textarea>

                <div class="modal-actions">
                    <button class="btn" type="button" data-action="close-modal" data-modal-id="postCreateModal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- EDIT POST MODAL -->
    <div id="postEditModal" class="modal-overlay" aria-hidden="true"
         th:if="${isTeacher and hasClass}"
         th:fragment="postEditModal">
        <div class="modal" style="max-width:720px;">
            <div class="modal-header">
                <div class="modal-title">Edit Post</div>
                <button class="modal-close" type="button" data-action="close-modal" data-modal-id="postEditModal">×</button>
            </div>

            <form id="postEditForm" class="modal-body" method="post" action="/classroom/post/assignment/edit" enctype="multipart/form-data">
                <input type="hidden" th:if="${_csrf != null}"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="classroomId" th:value="${classroom.classId}" />
                <input type="hidden" id="pePostId" name="postId" value="" />

                <label class="field-label" for="peTitle">Title</label>
                <input id="peTitle" class="input" name="title" maxlength="80" required />

                <label class="field-label" for="peDesc">Description</label>
                <textarea id="peDesc" class="textarea" name="description" maxlength="4000"></textarea>

                <div id="peExistingAttachmentsSection" style="display:none;">
                    <div class="field-label">Existing attachments</div>
                    <div id="peExistingAttachments" class="file-preview file-preview-existing" aria-live="polite"></div>
                    <div class="help">Click × to remove an attachment from this post.</div>
                </div>

                <!-- Assignment-only fields -->
                <div id="peAssignmentFields">
                    <div class="row">
                        <div class="col">
                            <label class="field-label" for="peDueLocal">Due</label>
                            <input id="peDueLocal" class="input" type="datetime-local" />
                            <input type="hidden" id="peDueHidden" name="dueDate" />
                            <div class="help">Leave blank for no due date.</div>
                        </div>
                        <div class="col">
                        <label class="field-label" for="peTtc">Time to complete</label>
                        <input id="peTtc" class="input" name="timeToComplete" maxlength="32" placeholder="e.g. 2h" />
                    </div>
                </div>

                    <label class="field-label" for="peMax">Maximum marks</label>
                    <input id="peMax" class="input" name="maxMarks" type="number" min="0" placeholder="0" />

                    <label class="field-label" for="peAssignmentFile">Add attachment (optional)</label>
                    <input id="peAssignmentFile" class="input js-file-input" type="file" name="file" multiple data-preview-target="peAssignmentPreview" />
                    <div id="peAssignmentPreview" class="file-preview" aria-live="polite"></div>
                </div>

                <!-- Resource-only fields -->
                <div id="peResourceFields" style="display:none;">
                    <label class="field-label" for="peResourceFile">Replace uploaded file (optional)</label>
                    <input id="peResourceFile" class="input js-file-input" type="file" name="file" multiple data-preview-target="peResourcePreview" />
                    <div id="peResourcePreview" class="file-preview" aria-live="polite"></div>
                    <label class="field-label" for="peReplaceAtts" style="display:flex;align-items:center;gap:10px;margin-top:10px;">
                        <input id="peReplaceAtts" type="checkbox" name="replaceAttachments" value="true" />
                        Replace existing attachment(s)
                    </label>
                    <div class="help">If checked, existing attachment(s) will be replaced with the uploaded file.</div>
                </div>

                <div class="modal-actions">
                    <button class="btn" type="button" data-action="close-modal" data-modal-id="postEditModal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- STUDENT SUBMIT MODAL -->
    <div id="submitModal" class="modal-overlay" aria-hidden="true"
         th:if="${isStudent and hasClass}"
         th:fragment="submitModal">
        <div class="modal" style="max-width:720px;">
            <div class="modal-header">
                <div class="modal-title">Submit Assignment</div>
                <button class="modal-close" type="button" data-action="close-modal" data-modal-id="submitModal">×</button>
            </div>

            <form class="modal-body"
                  method="post"
                  th:action="@{/classroom/post/assignment/submit}"
                  enctype="multipart/form-data">

                <input type="hidden" th:if="${_csrf != null}"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="classroomId" th:value="${classroom.classId}" />
                <input type="hidden" id="smAssignmentId" name="assignmentId" value="" />

                <label class="field-label" for="smFile">Upload work</label>
                <input id="smFile" class="input js-file-input" type="file" name="file" data-preview-target="smPreview" />
                <div id="smPreview" class="file-preview" aria-live="polite"></div>
                <div class="help">Optional: submit without a file if you only want to mark complete.</div>

                <label class="field-label" for="smMarkComplete" style="display:flex;align-items:center;gap:10px;">
                    <input id="smMarkComplete" type="checkbox" name="markComplete" value="true" />
                    Mark as complete
                </label>

                <div class="modal-actions">
                    <button class="btn" type="button" data-action="close-modal" data-modal-id="submitModal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- EDIT CLASSROOM MODAL -->
    <div id="classroomEditModal" class="modal-overlay" aria-hidden="true"
         th:if="${isTeacher and hasClass}"
         th:fragment="classroomEditModal">
        <div class="modal" style="max-width:860px;">
            <div class="modal-header">
                <div class="modal-title">Edit Classroom</div>
                <button class="modal-close" type="button" data-action="close-modal" data-modal-id="classroomEditModal">×</button>
            </div>

            <div class="modal-body" style="padding-top:0;">
                <form method="post" action="/classrooms/update">
                    <input type="hidden" th:if="${_csrf != null}"
                           th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="hidden" name="classId" th:value="${classroom.classId}" />

                    <label class="field-label" for="ceName">Name</label>
                    <input id="ceName" class="input" name="name" maxlength="60" th:value="${classroom.name}" required />

                    <label class="field-label" for="ceDesc">Description</label>
                    <textarea id="ceDesc" class="textarea" name="description" maxlength="500" th:text="${classroom.description}"></textarea>

                    <div class="modal-actions" style="justify-content:flex-end;">
                        <button class="btn btn-primary" type="submit">Save</button>
                    </div>
                </form>

                <div style="margin-top:14px;">
                    <form method="post" action="/classrooms/delete"
                          onsubmit="return confirm('Delete this classroom? This cannot be undone.');">
                        <input type="hidden" th:if="${_csrf != null}"
                               th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="classId" th:value="${classroom.classId}" />
                        <button class="btn btn-danger" type="submit">Delete classroom</button>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="btn" type="button" data-action="close-modal" data-modal-id="classroomEditModal">Close</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
